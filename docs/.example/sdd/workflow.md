# ワークフロー

---

# Phase 1: 仕様書作成フェーズ

---

## Preparation(準備)

- 新規リポジトリ作成
- 過去のプロジェクトデータをコピー
- SDDドキュメントをコピー（docs/.example/sdd/）

## AIAnalysis(AI分析)

- SDDドキュメントをAIに読ませる
  - design-document.md: 基本思想と設計方針
  - workflow.md: ワークフロー
  - directory-example.md: ディレクトリ構造
  - specification-example.md: 仕様書記述ルール
- 過去PJデータをAIに読ませる
  - プロジェクト全体の構造を理解
  - 既存コード、コンポーネント、ページを分析
  - 既存のデザインシステム、アーキテクチャを把握

## CreatePlan(プラン作成)

- /docs/plan/にプランドキュメントを作成
  - design_upgrade_plan.md: デザインバージョンアッププラン
  - frontend_architecture_upgrade_plan.md: 設計バージョンアップ&リファクタリングプラン
  - api_mocking_plan.md: APIモック化プラン
- 各プランはSDDで仕様書を作成するための指針
- ユーザー確認を待つ

## CreateDocumentation(ドキュメント作成)

- /docsディレクトリ作成
  - 過去PJを参考にSDDドキュメントに準じた構造を作成
  - directory-example.md を参照
  - /docs/ui/, /docs/features/ 等の構造を作成
- ユーザー確認を待つ

## CreateSpecification(仕様書作成)

- SDD仕様書作成
  - /docs/ui/variables/: デザイントークン仕様書
  - /docs/ui/components/: コンポーネント仕様書
  - /docs/ui/pages/: ページ仕様書
  - /docs/features/: 機能仕様書
  - specification-example.md を参照
  - 記述ルール遵守: 簡潔、具体的、実用的
  - 今回はimage.pngは無し
- ユーザー確認を待つ

## VerifySpecification(仕様書確認)

- 過去PJ＆プランと照らし合わせて必要な仕様書がすべて揃っているか確認
  - 過去PJのコンポーネント、ページ、機能を全て確認
  - プランドキュメント（design_upgrade_plan.md、frontend_architecture_upgrade_plan.md、api_mocking_plan.md）と照合
  - 不足している仕様書を特定
- 必要があれば修正
  - 不足している仕様書を作成
  - 仕様書の追加・削除を実施
- 過去PJ＆プランと照らし合わせて仕様書の内容が正しく記述されているか確認
  - 既存コードと仕様書の内容を照合
  - プランドキュメントの要件と仕様書の内容を照合
  - 数値、状態、動作の正確性を確認
  - Tailwind CSSへの変換が正しく記述されているか確認
- 必要があれば修正
  - 誤りや不足を修正
  - 仕様書の内容を更新
- 再度過去PJ＆プランと照らし合わせて確認
  - 既存コードと仕様書の内容を再照合
  - プランドキュメントの要件と仕様書の内容を再照合
  - 数値、状態、動作の正確性を再確認
- 完成度をチェック
  - 仕様書の完成度を評価
  - 不足や課題を特定
- 完成度が低い場合: 修正 → 確認（上記の確認と完成度チェックを繰り返す）
- 完成度が十分な場合: 変更がされた箇所の説明と、完成度の報告
  - 修正した箇所の説明
  - 仕様書の完成度報告
  - レポート作成: docs/.log/{日付}/VERIFY_SPECIFICATION_REPORT.md
    - 確認結果サマリー
    - 作成済み仕様書の一覧
    - 未作成仕様書の一覧
    - 仕様書の内容確認結果
    - 修正した箇所の説明
    - 完成度評価
    - 次のステップ
- ユーザー確認を待つ

---

# Phase 2: 実装フェーズ

---

## SessionStart(セッション開始)

Phase 2は新しいセッションで開始します。以下のプロンプトを使用してください。

```
このプロジェクトの全てのドキュメントをよく読んでください

・今のプロジェクトは過去PJからのコピーである
・その情報から/docsの中にある仕様書を作成した
・作成したルールはdocs\.example\sddのもの
・今後もdocs\.example\sddに書いてある仕様駆動開発ルールに沿って開発するので、特にこのドキュメントはよく覚えること
・現在は「# Phase 1: 仕様書作成フェーズ」まで完了している
```

## BackupExistingProject(既存プロジェクトのバックアップ)

- 過去PJのバックアップ
  - バックアップ先: docs/.old/{日付}/backup/
  - 既存データ(コンポーネント、ページ、関連ファイル)を全てコピー
- 過去PJの仕様書の作成
  - バックアップ先: docs/.old/{日付}/specification/
  - AIに既存コードを読ませて specification.md を生成
  - SDDドキュメントに準じた仕様書を作成
- 過去PJのテストコード作成
  - バックアップ先: docs/.old/{日付}/tests/
  - 既存の動作を保証するテストを生成
- ユーザー確認を待つ

## CopyImages(画像コピー)

- プロジェクト内の画像ファイルをdocs/ui/image/に集約
  - src/images/配下の全画像ファイルをコピー
  - public/favicon/配下のファイルをコピー（docs/ui/image/favicon/に配置）
  - public/images/配下のファイルをコピー（docs/ui/image/public-images/に配置）
  - サブディレクトリ構造も維持してコピー
- ユーザー確認を待つ

## Cleanup(クリーンアップ)

- 仕様書の理解
  - /docs/ui/配下の全仕様書を読み込み、実装対象を理解
  - /docs/features/配下の全仕様書を読み込み、実装対象を理解
  - /docs/schemas/配下の全仕様書を読み込み、実装対象を理解
  - 実装のために必要なファイル構造を把握
- 現PJからの削除ファイル選定
  - 仕様書に基づく実装のために削除が必要なファイルを選定
  - バックアップにあるか確認
  - 削除対象のファイルリストを提示
  - レポート作成: docs/.log/{日付}/CLEANUP_FILE_SELECTION_REPORT.md
- ユーザー確認を待つ
- 削除実行
  - バックアップ済みであることを確認してから削除
- 削除実行レポート作成
  - レポート作成: docs/.log/{日付}/CLEANUP_EXECUTION_REPORT.md
    - 実行結果
    - 削除内容（各カテゴリごとの詳細）
    - 削除後の状態
    - バックアップ確認
    - 次のステップ
- ユーザー確認を待つ

## Implementation(実装生成)

### ディレクトリ作成とテストコード生成

- /srcディレクトリ作成
  - /docsディレクトリと1対1対応する構造を作成
  - directory-example.md を参照
- ディレクトリ作成確認
  - 作成したディレクトリ構造を確認
  - /docsと/srcの1対1対応を確認
- ディレクトリ作成レポート作成
  - レポート作成: docs/.log/{日付}/DIRECTORY_CREATION_REPORT.md
    - 実行結果
    - 作成したディレクトリ構造（各カテゴリごとの詳細）
    - /docsと/srcの1対1対応確認結果
    - ディレクトリ構造の整合性確認
    - 次のステップ
- ユーザー確認を待つ
- /srcテストコード作成
  - /srcディレクトリで作成したディレクトリ内にテストコードを作成
  - 仕様書から必要なテストケースを抽出
  - テスト駆動で実装
- テストコード確認と修正
  - 作成したテストコードを確認
  - 仕様書との対応を確認
  - テストケースの網羅性を確認
  - テストコードの正確性を確認
  - 不足や誤りを特定
- 必要があれば修正
  - 不足しているテストケースを追加
  - 誤りを修正
  - テストコードの内容を更新
- 再度テストコード確認
  - 作成したテストコードを再確認
  - 仕様書との対応を再確認
  - テストケースの網羅性を再確認
  - テストコードの正確性を再確認
- 完成度をチェック
  - テストコードの完成度を評価
  - 不足や課題を特定
- 完成度が低い場合: 修正 → 確認（上記の確認と完成度チェックを繰り返す）
- 完成度が十分な場合: 変更がされた箇所の説明と、完成度の報告
  - 修正した箇所の説明
  - テストコードの完成度報告
  - レポート作成: docs/.log/{日付}/TEST_CODE_VERIFICATION_REPORT.md
    - 作成したテストコードの一覧
    - 仕様書との対応確認結果
    - テストケースの網羅性確認
    - テストコードの正確性確認
    - 不足しているテストケースの特定
    - 修正した箇所の説明
    - 完成度評価
    - 次のステップ
- ユーザー確認を待つ

### コード生成とテスト実行

- 既存ファイルの確認と更新
  - 削除しなかったファイルを確認（package.json、tsconfig.json、next.config.mjs等）
  - バックアップ取っているか確認（docs/.old/{日付}/backup/に存在するか）
  - 仕様を確認（docs/features/config/等の仕様書を参照）
  - 仕様に合わせて修正
    - package.json: 必要なパッケージの追加・更新
    - tsconfig.json: TypeScript設定の更新
    - next.config.mjs: Next.js設定の更新
    - その他設定ファイルの更新
  - 仕様と照らし合わせて確認
    - 更新したファイルが仕様書の内容と一致しているか確認
    - 不足や誤りがないか確認
- ユーザー確認を待つ
- /srcコード生成と確認
  - 仕様とテストコードをよく読む
    - /docs/ui/配下の全仕様書を読み込み、実装対象を理解
    - /docs/features/配下の全仕様書を読み込み、実装対象を理解
    - /src配下の全テストコードを読み込み、実装要件を理解
  - 全てのコード生成
    - /srcディレクトリで作成したディレクトリ内にコードを生成
    - 仕様とテストコードから、コードを作成
    - フロントのui-kitであれば全画面のハリボテページを作成
      - /showcase/ui-kit/{component-name} に配置
    - ui-featuresの挙動がわかるモック付きのハリボテも作成
      - /showcase/ui-features/{feature-name} に配置
  - 仕様とテストコードと照らし合わせて確認
    - 生成したコードが仕様書の内容と一致しているか確認
    - 生成したコードがテストコードの要件を満たしているか確認
    - 不足や誤りを特定
  - 不足があれば修正
    - 不足している実装を追加
    - 誤りを修正
    - コードの内容を更新
  - 再度仕様とテストコードと照らし合わせて確認
    - 生成したコードを再確認
    - 仕様書との対応を再確認
    - テストコードの要件との対応を再確認
  - 完成度をチェック
    - コードの完成度を評価
    - 不足や課題を特定
  - 完成度が低い場合: 修正 → 確認（上記の確認と完成度チェックを繰り返す）
  - 完成度が十分な場合: 変更がされた箇所の説明と、完成度の報告
    - 修正した箇所の説明
    - コードの完成度報告
    - レポート作成: docs/.log/{日付}/CODE_GENERATION_REPORT.md
      - 生成したコードの一覧
      - 仕様書との対応確認結果
      - テストコードとの対応確認結果
      - 不足していた実装の特定
      - 修正した箇所の説明
      - 完成度評価
      - 次のステップ
  - ユーザー確認を待つ
- テスト実行
  - テストコードを走らせ、実装チェックをする
  - エラー箇所チェック
    - テスト実行結果を確認
    - 失敗したテストを特定
    - エラーの原因を分析
  - 修正
    - エラーの原因に基づいて修正
    - Jest設定の修正（必要に応じて）
    - テスト環境のモック追加（必要に応じて）
    - テストコードの修正（必要に応じて）
    - 実装コードの修正（必要に応じて）
  - テスト実行（上記のエラー箇所チェックと修正を繰り返す）
    - 修正後、再度テストを実行
    - エラーが残っている場合は、エラー箇所チェックと修正を繰り返す
  - 全テスト通過が必須
  - レポート作成: docs/.log/{日付}/TEST_EXECUTION_REPORT.md
    - テスト実行結果のサマリー
    - 成功したテスト一覧
    - 失敗したテストとその原因
    - 修正内容の説明
    - 最終的なテスト通過状況
- ユーザー確認を待つ

### 環境立ち上げとブラウザテスト

- 仮想環境立ち上げ
  - ローカル起動できるようセットアップ
  - 必要なパッケージインストール確認
- ユーザー確認を待つ
- ブラウザで動作チェック
  - localhost でハリボテページを確認
  - 各状態(hover, active, disabled等)の動作確認
  - バックアップにある仕様やテストコードから、新しい実装が不足なく正しく作られているか確認
    - 既存機能の後退がないことを確認
